import{c as qe}from"./p7j97DnR.js";import{g as xe,r as P,i as Se,a7 as je,a8 as Ue,j as N,a9 as ye,l as de,o as w,c as T,G as Je,m as H,aa as Xe,k as be,p as X,b as C,t as Ye,F as Y,n as F,d as ae,y as Qe,ab as Ze,z as et}from"./DOh1AU71.js";import{N as x,m as S,w as j,M as te,a as K,b as W,S as U,t as pe,P as ne,c as ce,T as D,d as tt,E as se,k as nt,e as fe,F as ke,f as He,D as st,g as rt,h as it,i as ot,j as at,l as lt,n as Ie,V as ut,o as dt,p as pt}from"./32fEDNaK.js";import ct from"./leIuTuNC.js";import ft from"./CI8OHxR3.js";import{u as ht,a as mt}from"./DuyO21MA.js";import gt from"./D9_9vxCD.js";import"./Cq0864AT.js";import"./CJITND_o.js";import"./CjbS9Grt.js";import"./DY7prswQ.js";const vt=xe({__name:"MonacoEditor.client",props:{lang:{default:()=>"plaintext"},options:{default:()=>({})},modelUri:{},modelValue:{default:()=>""}},emits:["update:modelValue","load"],setup(t,{expose:e,emit:n}){const s=t,r=n,i=P(!0),o=Se(()=>s.lang||s.options.language),a=je(),p=P(),c=Ue(),h={automaticLayout:!0};let u,d;return N(()=>s.modelValue,()=>{(u==null?void 0:u.getValue())!==s.modelValue&&(u==null||u.setValue(s.modelValue))}),N(()=>[s.lang,s.modelUri],()=>{d&&d.dispose(),d=c.editor.createModel(s.modelValue,o.value,s.modelUri),u==null||u.setModel(d)}),N(()=>s.options,()=>{u==null||u.updateOptions(ye(s.options,h))}),N(p,(m,v)=>{!p.value||v||(u=c.editor.create(p.value,ye(s.options,h)),d=c.editor.createModel(s.modelValue,o.value,s.modelUri),a.value=u,u.layout(),u.setModel(d),u.onDidChangeModelContent(()=>{r("update:modelValue",u.getValue())}),i.value=!1,r("load",u))}),e({$editor:a}),de(()=>{u==null||u.dispose(),d==null||d.dispose()}),(m,v)=>(w(),T("div",{ref_key:"editorElement",ref:p},[i.value?Je(m.$slots,"default",{key:0}):H("",!0)],512))}}),yt=/^\s*>\s$/,bt=x.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[j({find:yt,type:this.type})]}}),kt=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Mt=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Ct=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,wt=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,At=te.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[K({find:kt,type:this.type}),K({find:Ct,type:this.type})]},addPasteRules(){return[W({find:Mt,type:this.type}),W({find:wt,type:this.type})]}}),Tt="listItem",Me="textStyle",Ce=/^\s*([-+*])\s$/,Lt=x.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",S(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Tt,this.editor.getAttributes(Me)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=j({find:Ce,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=j({find:Ce,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Me),editor:this.editor})),[t]}}),xt=/(^|[^`])`([^`]+)`(?!`)/,St=/(^|[^`])`([^`]+)`(?!`)/g,Ht=te.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[K({find:xt,type:this.type})]},addPasteRules(){return[W({find:St,type:this.type})]}}),It=/^```([a-z]+)?[\s\n]$/,Pt=/^~~~([a-z]+)?[\s\n]$/,Et=x.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,i=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",S(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,o=s.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:s}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const a=r.after();return a===void 0?!1:s.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(U.near(s.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[pe({find:It,type:this.type,getAttributes:t=>({language:t[1]})}),pe({find:Pt,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new ne({key:new ce("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,i=r==null?void 0:r.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,p=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},p)),o.selection.$from.parent.type!==this.type&&o.setSelection(D.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),Pe=x.create({name:"doc",topNode:!0,content:"block+"});function _t(t={}){return new ne({view(e){return new Rt(e,t)}})}class Rt{constructor(e,n){var s;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=n.width)!==null&&s!==void 0?s:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let i=o=>{this[r](o)};return e.dom.addEventListener(r,i),{name:r,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,s;if(n){let a=e.nodeBefore,p=e.nodeAfter;if(a||p){let c=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(c){let h=c.getBoundingClientRect(),u=a?h.bottom:h.top;a&&p&&(u=(u+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),s={left:h.left,right:h.right,top:u-this.width/2,bottom:u+this.width/2}}}}if(!s){let a=this.editorView.coordsAtPos(this.cursorPos);s={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let r=this.editorView.dom.offsetParent;this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let i,o;if(!r||r==document.body&&getComputedStyle(r).position=="static")i=-pageXOffset,o=-pageYOffset;else{let a=r.getBoundingClientRect();i=a.left-r.scrollLeft,o=a.top-r.scrollTop}this.element.style.left=s.left-i+"px",this.element.style.top=s.top-o+"px",this.element.style.width=s.right-s.left+"px",this.element.style.height=s.bottom-s.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),s=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),r=s&&s.type.spec.disableDropCursor,i=typeof r=="function"?r(this.editorView,n,e):r;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=tt(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)}}const Ot=se.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[_t(this.options)]}});class b extends U{constructor(e){super(e,e)}map(e,n){let s=e.resolve(n.map(this.head));return b.valid(s)?new b(s):U.near(s)}content(){return He.empty}eq(e){return e instanceof b&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new b(e.resolve(n.pos))}getBookmark(){return new he(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Bt(e)||!Dt(e))return!1;let s=n.type.spec.allowGapCursor;if(s!=null)return s;let r=n.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,n,s=!1){e:for(;;){if(!s&&b.valid(e))return e;let r=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;r+=n;let p=e.doc.resolve(r);if(b.valid(p))return p}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!fe.isSelectable(i)){e=e.doc.resolve(r+i.nodeSize*n),s=!1;continue e}break}i=o,r+=n;let a=e.doc.resolve(r);if(b.valid(a))return a}return null}}}b.prototype.visible=!1;b.findFrom=b.findGapCursorFrom;U.jsonID("gapcursor",b);class he{constructor(e){this.pos=e}map(e){return new he(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return b.valid(n)?new b(n):U.near(n)}}function Bt(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),s=t.node(e);if(n==0){if(s.type.spec.isolating)return!0;continue}for(let r=s.child(n-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function Dt(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),s=t.node(e);if(n==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let r=s.child(n);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function $t(){return new ne({props:{decorations:Ft,createSelectionBetween(t,e,n){return e.pos==n.pos&&b.valid(n)?new b(n):null},handleClick:Vt,handleKeyDown:Nt,handleDOMEvents:{beforeinput:zt}}})}const Nt=nt({ArrowLeft:Q("horiz",-1),ArrowRight:Q("horiz",1),ArrowUp:Q("vert",-1),ArrowDown:Q("vert",1)});function Q(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,r,i){let o=s.selection,a=e>0?o.$to:o.$from,p=o.empty;if(o instanceof D){if(!i.endOfTextblock(n)||a.depth==0)return!1;p=!1,a=s.doc.resolve(e>0?a.after():a.before())}let c=b.findGapCursorFrom(a,e,p);return c?(r&&r(s.tr.setSelection(new b(c))),!0):!1}}function Vt(t,e,n){if(!t||!t.editable)return!1;let s=t.state.doc.resolve(e);if(!b.valid(s))return!1;let r=t.posAtCoords({left:n.clientX,top:n.clientY});return r&&r.inside>-1&&fe.isSelectable(t.state.doc.nodeAt(r.inside))?!1:(t.dispatch(t.state.tr.setSelection(new b(s))),!0)}function zt(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof b))return!1;let{$from:n}=t.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!s)return!1;let r=ke.empty;for(let o=s.length-1;o>=0;o--)r=ke.from(s[o].createAndFill(null,r));let i=t.state.tr.replace(n.pos,n.pos,new He(r,0,0));return i.setSelection(D.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function Ft(t){if(!(t.selection instanceof b))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",st.create(t.doc,[rt.widget(t.selection.head,e,{key:"gapcursor"})])}const Kt=se.create({name:"gapCursor",addProseMirrorPlugins(){return[$t()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=it(ot(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),Wt=x.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",S(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:s})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:r,storedMarks:i}=n;if(r.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=s.extensionManager,p=i||r.$to.parentOffset&&r.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:h})=>{if(h&&p&&o){const u=p.filter(d=>a.includes(d.type.name));c.ensureMarks(u)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),Ee=x.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,S(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>pe({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var ee=200,L=function(){};L.prototype.append=function(e){return e.length?(e=L.from(e),!this.length&&e||e.length<ee&&this.leafAppend(e)||this.length<ee&&e.leafPrepend(this)||this.appendInner(e)):this};L.prototype.prepend=function(e){return e.length?L.from(e).append(this):this};L.prototype.appendInner=function(e){return new Gt(this,e)};L.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?L.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};L.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};L.prototype.forEach=function(e,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length),n<=s?this.forEachInner(e,n,s,0):this.forEachInvertedInner(e,n,s,0)};L.prototype.map=function(e,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length);var r=[];return this.forEach(function(i,o){return r.push(e(i,o))},n,s),r};L.from=function(e){return e instanceof L?e:e&&e.length?new _e(e):L.empty};var _e=function(t){function e(s){t.call(this),this.values=s}e.__proto__=t,e.prototype=Object.create(t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(r,i){return r==0&&i==this.length?this:new e(this.values.slice(r,i))},e.prototype.getInner=function(r){return this.values[r]},e.prototype.forEachInner=function(r,i,o,a){for(var p=i;p<o;p++)if(r(this.values[p],a+p)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,o,a){for(var p=i-1;p>=o;p--)if(r(this.values[p],a+p)===!1)return!1},e.prototype.leafAppend=function(r){if(this.length+r.length<=ee)return new e(this.values.concat(r.flatten()))},e.prototype.leafPrepend=function(r){if(this.length+r.length<=ee)return new e(r.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(L);L.empty=new _e([]);var Gt=function(t){function e(n,s){t.call(this),this.left=n,this.right=s,this.length=n.length+s.length,this.depth=Math.max(n.depth,s.depth)+1}return e.__proto__=t,e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,r,i,o){var a=this.left.length;if(r<a&&this.left.forEachInner(s,r,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(s,Math.max(r-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(s,r,i,o){var a=this.left.length;if(r>a&&this.right.forEachInvertedInner(s,r-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(s,Math.min(r,a),i,o)===!1)return!1},e.prototype.sliceInner=function(s,r){if(s==0&&r==this.length)return this;var i=this.left.length;return r<=i?this.left.slice(s,r):s>=i?this.right.slice(s-i,r-i):this.left.slice(s,i).append(this.right.slice(0,r-i))},e.prototype.leafAppend=function(s){var r=this.right.leafAppend(s);if(r)return new e(this.left,r)},e.prototype.leafPrepend=function(s){var r=this.left.leafPrepend(s);if(r)return new e(r,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e}(L);const qt=500;class E{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let r,i;n&&(r=this.remapping(s,this.items.length),i=r.maps.length);let o=e.tr,a,p,c=[],h=[];return this.items.forEach((u,d)=>{if(!u.step){r||(r=this.remapping(s,d+1),i=r.maps.length),i--,h.push(u);return}if(r){h.push(new _(u.map));let m=u.step.map(r.slice(i)),v;m&&o.maybeStep(m).doc&&(v=o.mapping.maps[o.mapping.maps.length-1],c.push(new _(v,void 0,void 0,c.length+h.length))),i--,v&&r.appendMap(v,i)}else o.maybeStep(u.step);if(u.selection)return a=r?u.selection.map(r.slice(i)):u.selection,p=new E(this.items.slice(0,s).append(h.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:p,transform:o,selection:a}}addTransform(e,n,s,r){let i=[],o=this.eventCount,a=this.items,p=!r&&a.length?a.get(a.length-1):null;for(let h=0;h<e.steps.length;h++){let u=e.steps[h].invert(e.docs[h]),d=new _(e.mapping.maps[h],u,n),m;(m=p&&p.merge(d))&&(d=m,h?i.pop():a=a.slice(0,a.length-1)),i.push(d),n&&(o++,n=void 0),r||(p=d)}let c=o-s.depth;return c>Ut&&(a=jt(a,c),o-=c),new E(a.append(i),o)}remapping(e,n){let s=new at;return this.items.forEach((r,i)=>{let o=r.mirrorOffset!=null&&i-r.mirrorOffset>=e?s.maps.length-r.mirrorOffset:void 0;s.appendMap(r.map,o)},e,n),s}addMaps(e){return this.eventCount==0?this:new E(this.items.append(e.map(n=>new _(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let s=[],r=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(d=>{d.selection&&a--},r);let p=n;this.items.forEach(d=>{let m=i.getMirror(--p);if(m==null)return;o=Math.min(o,m);let v=i.maps[m];if(d.step){let I=e.steps[m].invert(e.docs[m]),R=d.selection&&d.selection.map(i.slice(p+1,m));R&&a++,s.push(new _(v,I,R))}else s.push(new _(v))},r);let c=[];for(let d=n;d<o;d++)c.push(new _(i.maps[d]));let h=this.items.slice(0,r).append(c).append(s),u=new E(h,a);return u.emptyItemCount()>qt&&(u=u.compress(this.items.length-s.length)),u}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),s=n.maps.length,r=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)r.push(o),o.selection&&i++;else if(o.step){let p=o.step.map(n.slice(s)),c=p&&p.getMap();if(s--,c&&n.appendMap(c,s),p){let h=o.selection&&o.selection.map(n.slice(s));h&&i++;let u=new _(c.invert(),p,h),d,m=r.length-1;(d=r.length&&r[m].merge(u))?r[m]=d:r.push(u)}}else o.map&&s--},this.items.length,0),new E(L.from(r.reverse()),i)}}E.empty=new E(L.empty,0);function jt(t,e){let n;return t.forEach((s,r)=>{if(s.selection&&e--==0)return n=r,!1}),t.slice(n)}class _{constructor(e,n,s,r){this.map=e,this.step=n,this.selection=s,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new _(n.getMap().invert(),n,this.selection)}}}class B{constructor(e,n,s,r,i){this.done=e,this.undone=n,this.prevRanges=s,this.prevTime=r,this.prevComposition=i}}const Ut=20;function Jt(t,e,n,s){let r=n.getMeta(V),i;if(r)return r.historyState;n.getMeta(Qt)&&(t=new B(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(V))return o.getMeta(V).redo?new B(t.done.addTransform(n,void 0,s,Z(e)),t.undone,we(n.mapping.maps),t.prevTime,t.prevComposition):new B(t.done,t.undone.addTransform(n,void 0,s,Z(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),p=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-s.newGroupDelay||!Xt(n,t.prevRanges)),c=o?le(t.prevRanges,n.mapping):we(n.mapping.maps);return new B(t.done.addTransform(n,p?e.selection.getBookmark():void 0,s,Z(e)),E.empty,c,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new B(t.done.rebased(n,i),t.undone.rebased(n,i),le(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new B(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),le(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function Xt(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((s,r)=>{for(let i=0;i<e.length;i+=2)s<=e[i+1]&&r>=e[i]&&(n=!0)}),n}function we(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((s,r,i,o)=>e.push(i,o));return e}function le(t,e){if(!t)return null;let n=[];for(let s=0;s<t.length;s+=2){let r=e.map(t[s],1),i=e.map(t[s+1],-1);r<=i&&n.push(r,i)}return n}function Yt(t,e,n){let s=Z(e),r=V.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,s);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),r,s),p=new B(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(V,{redo:n,historyState:p})}let ue=!1,Ae=null;function Z(t){let e=t.plugins;if(Ae!=e){ue=!1,Ae=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){ue=!0;break}}return ue}const V=new ce("history"),Qt=new ce("closeHistory");function Zt(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new ne({key:V,state:{init(){return new B(E.empty,E.empty,null,0,-1)},apply(e,n,s){return Jt(n,s,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let s=n.inputType,r=s=="historyUndo"?Oe:s=="historyRedo"?Be:null;return r?(n.preventDefault(),r(e.state,e.dispatch)):!1}}}})}function Re(t,e){return(n,s)=>{let r=V.getState(n);if(!r||(t?r.undone:r.done).eventCount==0)return!1;if(s){let i=Yt(r,n,t);i&&s(e?i.scrollIntoView():i)}return!0}}const Oe=Re(!1,!0),Be=Re(!0,!0),en=se.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>Oe(t,e),redo:()=>({state:t,dispatch:e})=>Be(t,e)}},addProseMirrorPlugins(){return[Zt(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),tn=x.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",S(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{const{selection:n}=e,{$from:s,$to:r}=n,i=t();return s.parentOffset===0?i.insertContentAt({from:Math.max(s.pos-1,0),to:r.pos},{type:this.name}):lt(n)?i.insertContentAt(r.pos,{type:this.name}):i.insertContent({type:this.name}),i.command(({tr:o,dispatch:a})=>{var p;if(a){const{$to:c}=o.selection,h=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?o.setSelection(D.create(o.doc,c.pos+1)):c.nodeAfter.isBlock?o.setSelection(fe.create(o.doc,c.pos)):o.setSelection(D.create(o.doc,c.pos));else{const u=(p=c.parent.type.contentMatch.defaultType)===null||p===void 0?void 0:p.create();u&&(o.insert(h,u),o.setSelection(D.create(o.doc,h+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Ie({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),nn=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,sn=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,rn=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,on=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,an=te.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[K({find:nn,type:this.type}),K({find:rn,type:this.type})]},addPasteRules(){return[W({find:sn,type:this.type}),W({find:on,type:this.type})]}}),ln=x.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",S(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),un="listItem",Te="textStyle",Le=/^(\d+)\.\s$/,dn=x.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:void 0,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",S(this.options.HTMLAttributes,n),0]:["ol",S(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(un,this.editor.getAttributes(Te)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=j({find:Le,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=j({find:Le,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(Te)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),De=x.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),pn=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,cn=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,fn=te.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",S(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[K({find:pn,type:this.type})]},addPasteRules(){return[W({find:cn,type:this.type})]}}),$e=x.create({name:"text",group:"inline"}),hn=se.create({name:"starterKit",addExtensions(){var t,e,n,s,r,i,o,a,p,c,h,u,d,m,v,I,R,$;const y=[];return this.options.bold!==!1&&y.push(At.configure((t=this.options)===null||t===void 0?void 0:t.bold)),this.options.blockquote!==!1&&y.push(bt.configure((e=this.options)===null||e===void 0?void 0:e.blockquote)),this.options.bulletList!==!1&&y.push(Lt.configure((n=this.options)===null||n===void 0?void 0:n.bulletList)),this.options.code!==!1&&y.push(Ht.configure((s=this.options)===null||s===void 0?void 0:s.code)),this.options.codeBlock!==!1&&y.push(Et.configure((r=this.options)===null||r===void 0?void 0:r.codeBlock)),this.options.document!==!1&&y.push(Pe.configure((i=this.options)===null||i===void 0?void 0:i.document)),this.options.dropcursor!==!1&&y.push(Ot.configure((o=this.options)===null||o===void 0?void 0:o.dropcursor)),this.options.gapcursor!==!1&&y.push(Kt.configure((a=this.options)===null||a===void 0?void 0:a.gapcursor)),this.options.hardBreak!==!1&&y.push(Wt.configure((p=this.options)===null||p===void 0?void 0:p.hardBreak)),this.options.heading!==!1&&y.push(Ee.configure((c=this.options)===null||c===void 0?void 0:c.heading)),this.options.history!==!1&&y.push(en.configure((h=this.options)===null||h===void 0?void 0:h.history)),this.options.horizontalRule!==!1&&y.push(tn.configure((u=this.options)===null||u===void 0?void 0:u.horizontalRule)),this.options.italic!==!1&&y.push(an.configure((d=this.options)===null||d===void 0?void 0:d.italic)),this.options.listItem!==!1&&y.push(ln.configure((m=this.options)===null||m===void 0?void 0:m.listItem)),this.options.orderedList!==!1&&y.push(dn.configure((v=this.options)===null||v===void 0?void 0:v.orderedList)),this.options.paragraph!==!1&&y.push(De.configure((I=this.options)===null||I===void 0?void 0:I.paragraph)),this.options.strike!==!1&&y.push(fn.configure((R=this.options)===null||R===void 0?void 0:R.strike)),this.options.text!==!1&&y.push($e.configure(($=this.options)===null||$===void 0?void 0:$.text)),y}}),mn=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,gn=x.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",S(this.options.HTMLAttributes,t)]},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[Ie({find:mn,type:this.type,getAttributes:t=>{const[,,e,n,s]=t;return{src:n,alt:e,title:s}}})]}}),vn=x.create({name:"colorWheel",group:"block",atom:!0,addAttributes(){return{sportColor:{default:"#FF6B6B"},cruiserColor:{default:"#4ECDC4"},urbanColor:{default:"#FFD93D"},offroadColor:{default:"#95E1D3"}}},parseHTML(){return[{tag:'div[data-type="color-wheel"]'}]},renderHTML({HTMLAttributes:t}){return["div",{"data-type":"color-wheel",...t},0]},addNodeView(){return ut(ct)}}),yn=qe(vt),bn={class:"editor-wrapper"},kn={key:0,class:"login-prompt"},Mn={key:1,class:"editor-layout"},Cn={class:"editor-main"},wn={class:"editor-toolbar"},An={class:"toolbar-left"},Tn={class:"file-path"},Ln={class:"toolbar-right"},xn={key:3,class:"toolbar-button loading",disabled:""},Sn={class:"editor-content"},Hn={key:0,class:"tiptap-toolbar"},In={key:1,class:"raw-content-wrapper"},Pn={key:2,class:"preview-wrapper"},En=["innerHTML"],Gn=xe({__name:"TiptapEditor",props:{content:{},filePath:{}},emits:["update:content","save","error"],setup(t,{emit:e}){const n=l=>{if(d.value)switch(l){case"colorwheel":d.value.chain().focus().insertContent({type:"colorWheel"}).run();break}},s={"split-with-image":`
    <div style="display: flex; gap: 2rem; margin: 3rem 0;">
      <div style="flex: 1;">
        <h2 style="margin: 0; font-size: 1.5rem; font-weight: 600; line-height: 1.4;">Section Title</h2>
      </div>
      <div style="flex: 2;">
        <div style="background: #f5f5f5; padding: 2rem; border-radius: 4px;">
          <img src="/api/placeholder/800/400" alt="Section Image" style="width: 100%; height: auto; display: block;" />
        </div>
        <h3 style="font-size: 1.25rem; font-weight: 600; margin: 1rem 0;">Add Subtitle</h3>
        <p style="margin: 1rem 0; line-height: 1.6;">Add your description here.</p>
        <p style="margin: 1rem 0; line-height: 1.6;">Add additional details here.</p>
      </div>
    </div>
  `,"split-with-list":`
    <div style="display: flex; gap: 2rem; margin: 3rem 0;">
      <div style="flex: 1;">
        <h2 style="margin: 0; font-size: 1.5rem; font-weight: 600; line-height: 1.4;">Section Title</h2>
      </div>
      <div style="flex: 2;">
        <img src="/api/placeholder/800/400" alt="Section Image" style="width: 100%; height: auto; display: block; padding: 2rem; border-radius: 4px;" />
        <p style="margin: 1rem 0; line-height: 1.6;">Add your description here.</p>
        <ul style="list-style: none; padding: 0; margin: 1rem 0;">
          <li style="margin: 0.5rem 0; line-height: 1.6;">List item one</li>
          <li style="margin: 0.5rem 0; line-height: 1.6;">List item two</li>
          <li style="margin: 0.5rem 0; line-height: 1.6;">List item three</li>
          <li style="margin: 0.5rem 0; line-height: 1.6;">List item four</li>
        </ul>
      </div>
    </div>
  `},r=l=>{if(!d.value)return;const f=s[l];f&&d.value.chain().focus().createParagraphNear().insertContent(f).focus().run()},i=t,o=e,a=P(""),p=P(""),c=P(!1),h=P(!1),u=P(!1),d=P(null),m=P(!1),v=P(""),I=P(null),{showToast:R}=et(),$=ht(),{isLoggedIn:y}=$,me=mt(),Ne=x.create({name:"styledDiv",group:"block",content:"block+",addAttributes(){return{style:{default:null,parseHTML:l=>l.getAttribute("style"),renderHTML:l=>l.style?{style:l.style}:{}},class:{default:null,parseHTML:l=>l.getAttribute("class"),renderHTML:l=>l.class?{class:l.class}:{}}}},parseHTML(){return[{tag:"div"}]},renderHTML({HTMLAttributes:l}){return["div",l,0]}}),Ve=x.create({name:"gridContainer",group:"block",content:"block+",addAttributes(){return{style:{default:null,parseHTML:l=>l.getAttribute("style"),renderHTML:l=>l.style?{style:l.style}:{}}}},parseHTML(){return[{tag:"div",getAttrs:l=>(l.getAttribute("style")||"").includes("grid")?{}:!1}]},renderHTML({HTMLAttributes:l}){return["div",l,0]}}),re=()=>{!O.value||c.value||(me.saveContent(i.filePath,a.value),R({title:"Success",message:"Content saved locally",type:"success"}))},ge=l=>l?l.replace(/::color-wheel\s*::/g,'<div data-type="color-wheel"></div>').replace(/::test-component\s*::/g,'<div data-type="test-component"></div>'):"",ze={theme:"vs",language:"html",fontSize:13,lineNumbers:"on",renderWhitespace:"selection",minimap:{enabled:!0,scale:1,showSlider:"mouseover"},scrollBeyondLastLine:!1,wordWrap:"on",lineHeight:20,padding:{top:16,bottom:16},folding:!0,foldingHighlight:!0,foldingStrategy:"indentation",showFoldingControls:"always",bracketPairColorization:{enabled:!0},autoClosingBrackets:"always",autoClosingQuotes:"always",autoClosingTags:!0,formatOnType:!0,formatOnPaste:!0,autoIndent:"advanced",tabSize:2,automaticLayout:!0,scrollbar:{vertical:"visible",horizontal:"visible",useShadows:!1,verticalHasArrows:!1,horizontalHasArrows:!1,verticalScrollbarSize:10,horizontalScrollbarSize:10},suggest:{snippetsPreventQuickSuggestions:!1,showWords:!1,showClasses:!0,showTags:!0,showAttributes:!0},quickSuggestions:{other:!0,comments:!1,strings:!0}},Fe=l=>{l&&(a.value=l,v.value=l,o("update:content",l))};N(u,l=>{d.value&&(l?Xe(()=>{I.value&&I.value.setValue(a.value)}):(d.value.commands.setContent(a.value,!1),v.value=a.value))}),N(()=>i.content,l=>{if(!d.value||l===void 0)return;const f=ge(l);f!==a.value&&(d.value.commands.setContent(f,!1),a.value=f,v.value=f)},{deep:!0}),be(()=>{if(me.loadSaves(),d.value=new dt({extensions:[hn.configure({document:!1,paragraph:!1,heading:!1,bulletList:!1,orderedList:!1}),Pe,$e,De.configure({HTMLAttributes:{class:null}}),Ee.configure({HTMLAttributes:{class:null}}),gn.configure({inline:!0,HTMLAttributes:{class:null}}),Ne,Ve,vn.configure({HTMLAttributes:{class:"color-wheel-node"}})],editorProps:{attributes:{spellcheck:"false"},transformPastedHTML:l=>l,handleDrop:!1,handleClick:(l,f,k)=>{const g=l.posAtCoords({left:k.clientX,top:k.clientY});if(!g)return!1;const{pos:M}=g;if(l.state.doc.resolve(M),!l.domAtPos(M))return!1;const A=k.target;return A.nodeName==="IMG"||A.closest("img")?!1:(l.dispatch(l.state.tr.setSelection(D.create(l.state.doc,M))),l.focus(),!0)},handleKeyDown:(l,f)=>{var k,g;if(f.key==="Enter"){const{state:M}=l,{selection:G}=M,{$from:A}=G,q=A.parent;let J=A.depth,oe=null;for(;J>0;){const z=A.node(J);if(z.type.name==="styledDiv"&&((k=z.attrs.style)!=null&&k.includes("display: flex"))){oe=z;break}J--}if(!oe)return!1;const We=(g=q.attrs.style)==null?void 0:g.includes("flex: 1");if(A.pos===M.doc.content.size&&f.shiftKey)return l.dispatch(M.tr.insert(A.pos,M.schema.nodes.styledDiv.create({style:"display: flex; gap: 2rem; margin: 3rem 0;"},[M.schema.nodes.styledDiv.create({style:"flex: 1;"},[M.schema.nodes.paragraph.create()]),M.schema.nodes.styledDiv.create({style:"flex: 2;"},[M.schema.nodes.paragraph.create()])]))),!0;if(We){if(f.shiftKey)return l.dispatch(M.tr.insert(A.pos,M.schema.nodes.hardBreak.create())),!0;const z=oe.lastChild;if(z){const ve=l.nodeDOM(z.pos);if(ve){const Ge=l.posAtDOM(ve,0);return l.dispatch(M.tr.setSelection(D.create(M.doc,Ge))),!0}}}else return!1}return f.key==="Tab"}},onUpdate:({editor:l})=>{var M,G;const{selection:f}=l.state,{$from:k}=f,g=k.parent;if(g.type.name==="styledDiv"&&((M=g.attrs.style)!=null&&M.includes("display: flex"))){k.node(),k.before(k.depth);let A=k.depth;for(;A>1;){if((G=k.node(A).attrs.style)!=null&&G.includes("display: flex")){k.before(A);break}A--}const q=l.getHTML();a.value=q,v.value=q,o("update:content",q)}else{const A=l.getHTML();a.value=A,v.value=A,o("update:content",A)}},parseOptions:{preserveWhitespace:"full"}}),i.content){const l=ge(i.content);d.value.commands.setContent(l,!1),a.value=l,p.value=l,v.value=l}m.value=!0}),be(()=>{const l=document.querySelector(".editor-content");l&&l.addEventListener("scroll",()=>{l.setAttribute("data-scroll-top",l.scrollTop.toString())})}),de(()=>{const l=document.querySelector(".editor-content");l&&l.removeEventListener("scroll",()=>{})}),N(u,l=>{d.value&&(l||(d.value.commands.setContent(a.value,!1),v.value=a.value))});const O=Se(()=>a.value!==p.value),ie=async()=>{var l;if(!(!O.value||c.value)){c.value=!0;try{if(!y.value)throw new Error("Please log in to GitHub first");{const k=(l=Ze().$content)==null?void 0:l.storage;k&&await k.clearAll()}o("save",a.value),p.value=a.value}catch(f){console.error("Save error:",f),R({title:"Error",message:f instanceof Error?f.message:"Failed to save changes",type:"error"}),o("error",f)}finally{c.value=!1}}},Ke=l=>{d.value&&(d.value.commands.setContent(l),a.value=l)};return de(()=>{d.value&&d.value.destroy(),I.value&&I.value.dispose()}),(l,f)=>{const k=yn;return w(),T("div",bn,[X(y)?(w(),T("div",Mn,[C("div",Cn,[C("div",wn,[C("div",An,[C("span",Tn,Ye(i.filePath),1)]),C("div",Ln,[!h.value&&!u.value?(w(),T(Y,{key:0},[C("button",{class:"toolbar-button",onClick:f[1]||(f[1]=g=>u.value=!0)}," Raw "),C("button",{class:"toolbar-button",onClick:f[2]||(f[2]=g=>h.value=!0)}," Preview "),O.value&&!c.value?(w(),T("button",{key:0,class:"toolbar-button primary",onClick:ie}," Commit Changes ")):H("",!0),O.value&&!c.value?(w(),T("button",{key:1,class:"toolbar-button primary",onClick:re}," Save Locally ")):H("",!0)],64)):H("",!0),u.value?(w(),T(Y,{key:1},[C("button",{class:"toolbar-button",onClick:f[3]||(f[3]=g=>u.value=!1)}," Normal "),C("button",{class:"toolbar-button",onClick:f[4]||(f[4]=g=>{h.value=!0,u.value=!1})}," Preview "),O.value&&!c.value?(w(),T("button",{key:0,class:"toolbar-button primary",onClick:ie}," Commit Changes ")):H("",!0),O.value&&!c.value?(w(),T("button",{key:1,class:"toolbar-button primary",onClick:re}," Save Locally ")):H("",!0)],64)):H("",!0),h.value?(w(),T(Y,{key:2},[C("button",{class:"toolbar-button",onClick:f[5]||(f[5]=g=>h.value=!1)}," Edit "),O.value&&!c.value?(w(),T("button",{key:0,class:"toolbar-button primary",onClick:ie}," Commit Changes ")):H("",!0),O.value&&!c.value?(w(),T("button",{key:1,class:"toolbar-button primary",onClick:re}," Save Locally ")):H("",!0)],64)):H("",!0),c.value?(w(),T("button",xn," Saving... ")):H("",!0)])]),C("div",Sn,[!h.value&&!u.value?(w(),T(Y,{key:0},[d.value?(w(),T("div",Hn,[C("button",{onClick:f[6]||(f[6]=g=>d.value.chain().focus().toggleBold().run()),class:F({"is-active":d.value.isActive("bold")})}," Bold ",2),C("button",{onClick:f[7]||(f[7]=g=>d.value.chain().focus().toggleItalic().run()),class:F({"is-active":d.value.isActive("italic")})}," Italic ",2),C("button",{onClick:f[8]||(f[8]=g=>d.value.chain().focus().toggleHeading({level:1}).run()),class:F({"is-active":d.value.isActive("heading",{level:1})})}," H1 ",2),C("button",{onClick:f[9]||(f[9]=g=>d.value.chain().focus().toggleHeading({level:2}).run()),class:F({"is-active":d.value.isActive("heading",{level:2})})}," H2 ",2),C("button",{onClick:f[10]||(f[10]=g=>d.value.chain().focus().toggleBulletList().run()),class:F({"is-active":d.value.isActive("bulletList")})}," List ",2),ae(gt,{onInsertComponent:n,onInsertSection:r})])):H("",!0),m.value?(w(),Qe(X(pt),{key:1,editor:d.value,class:F(["content-wrapper",{"has-changes":O.value}])},null,8,["editor","class"])):H("",!0)],64)):u.value?(w(),T("div",In,[ae(k,{modelValue:a.value,"onUpdate:modelValue":f[11]||(f[11]=g=>a.value=g),class:"monaco-editor",options:ze,onChange:Fe,onMount:f[12]||(f[12]=g=>I.value=g)},null,8,["modelValue"])])):(w(),T("div",Pn,[C("div",{class:"content-wrapper",innerHTML:v.value},null,8,En)]))])]),ae(ft,{filePath:i.filePath,onLoadSave:Ke},null,8,["filePath"])])):(w(),T("div",kn,[f[13]||(f[13]=C("p",{class:"login-message"},"Please sign in with GitHub to edit this file",-1)),C("button",{onClick:f[0]||(f[0]=(...g)=>X($).login&&X($).login(...g)),class:"login-button"}," Sign in with GitHub ")]))])}}});export{Gn as default};
